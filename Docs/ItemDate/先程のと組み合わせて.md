以前の回答で提示した、**貴金属貨幣（ゴールドの下位通貨4種）**、**高額取引通貨（金塊）**、**課金通貨（ジェム）**、**コンテンツ専用通貨（栄光の証、ギルドコイン）**、\*\*イベント限定通貨（星のしずく）\*\*を組み合わせた、最も包括的なMMO複数通貨システムのデータサンプルを提示します。

このシステムでは、通貨は大きく以下の4つのカテゴリに分類されます。

1. **基本通貨（貴金属）**: 日常の売買、修理、NPC取引に使用。  
2. **高額取引通貨（金塊）**: 巨大な資産やインフレ対策に使用。  
3. **特殊・限定通貨**: 特定の目的（PvP、ギルド、イベント）でのみ使用。  
4. **課金通貨（ジェム）**: リアルマネーとの交換に使用。

---

## **複合通貨システム：全体像と特徴**

| カテゴリ | 通貨名 | 単位 | 変換レート (対ゴールド換算) | 主な用途 |
| :---- | :---- | :---- | :---- | :---- |
| **基本通貨** (5段階) | **プラチナ** 💎 | P | G | 超高額取引、最終装備の材料 |
|  | **ゴールド** 🥇 | G | 基準 (10,000C) | 冒険者の主要取引 |
|  | **エレクトラム** 🟡 | E | G (1,000C) | 中間価格の調整 |
|  | **シルバー** 🥈 | S | G (100C) | 日常の取引、ポーション、修理費 |
|  | **カッパー** 🥉 | C | 最小単位 (1C) | 庶民の取引、極小の報酬 |
| **大型通貨** | **金塊** 💵 | 塊 | G | プレイヤー間取引での大量のゴールドの代わり（お札の役割） |
| **課金通貨** | **ジェム** ✨ | J | (レート変動) | プレミアムアイテム購入、リアルマネー収益 |
| **専用通貨** | **栄光の証** ⚔️ | 証 | (交換不可) | PvP専用装備や強化アイテム |
|  | **ギルドコイン** 🛡️ | GC | (交換不可) | ギルドスキルの購入、ギルドハウジング |
| **限定通貨** | **星のしずく** 🌟 | 雫 | (交換不可) | 期間限定イベントの報酬アイテム |

※ **変換レート**： G E S C (D\&Dの伝統的なレートに近い形)を採用。

---

## **プレイヤー所持金のデータサンプル**

以下は、3人のプレイヤーが上記の全通貨カテゴリで所持している量のサンプルです。

| プレイヤーID | プレイヤー名 | プラチナ (P) | ゴールド (G) | シルバー (S) | カッパー (C) | 金塊 (塊) | ジェム (J) | 栄光の証 (証) | ギルドコイン (GC) | 星のしずく (雫) |
| :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- | :---- |
| 1001 | Alice | 1 | 50 | 25 | 80 | 3 | 5,200 | 1,500 | 25,000 | 1,200 |
| 1002 | Bob | 0 | 5 | 80 | 10 | 0 | 150 | 15,400 | 5,000 | 8,500 |
| 1003 | Charlie | 0 | 1,200 | 0 | 0 | 1 | 100 | 80 | 500 | 50 |

### **データから読み取れる情報**

* **Alice (富裕な高レベルプレイヤー)**:  
  * **金塊**や**プラチナ**といった高額通貨を保有しており、基本通貨の総資産が非常に高いです。  
  * **ジェム**の所持量が多く、課金やゲーム内でのジェム交換（公式RMT）を利用している可能性があります。  
  * **ギルドコイン**が多く、ギルド活動に積極的に参加していることが伺えます。  
* **Bob (PvP・イベント熱心なプレイヤー)**:  
  * 基本通貨は控えめですが、**栄光の証**が非常に多く、PvPコンテンツのコアプレイヤーであることがわかります。  
  * **星のしずく**の所持量が最も多く、現在の期間限定イベントに最も時間を費やしていると考えられます。  
* **Charlie (一般的なプレイヤー)**:  
  * **ゴールド**を多めに持っていますが、**金塊**が1塊ある程度で、高額な資産はあまりありません。  
  * **ジェム**は少なめで、**専用通貨**や**限定通貨**の所持量も低く、特定のコンテンツには深く関わっていない標準的なプレイヤーの活動レベルを示しています。

---

## UGS Economy 登録手順（通貨）

1. **ダッシュボードで通貨を作成**  
   Unity Dashboard → Economy → Currencies → New Currency で以下のIDを作成（Display Name/Description/Iconは任意設定）:
   - `Platinum`（プラチナ）
   - `Gold`（ゴールド）
   - `Electrum`（エレクトラム）
   - `Silver`（シルバー）
   - `Copper`（カッパー）
   - `GoldBar`（金塊）
   - `Gem`（ジェム／課金）
   - `GloryToken`（栄光の証／PvP）
   - `GuildCoin`（ギルドコイン）
   - `StarDrop`（星のしずく／イベント）

2. **アイコン配布**  
   CCDに通貨アイコンをアップロードし、`iconKey`（例: `Icons/Currencies/gold`）を管理台帳に記録。

3. **Web管理コンソールからの操作**  
   - 作成/更新: `AdminUpsertCurrency`（Cloud Code）を呼び出し。
   - 付与/減算: `AdminGrantCurrency` / `AdminSubtractCurrency`。
   - 交換: `ExchangeCurrency`（後述のレート/手数料ポリシーに従う）。

## 高額感のある交換レート設計（ポリシー）

内部基準は最小単位`C（カッパー）= 1`。高額感を演出するため、桁差を大きく設定します。

- **基本通貨（対C換算）**
  - `Copper` = 1
  - `Silver` = 1,000  （1,000C = 1S）
  - `Electrum` = 10,000  （10S = 1E）
  - `Gold` = 10,000,000  （100E = 1G）
  - `Platinum` = 1,000,000,000  （100G = 1P）

- **高額通貨（金塊）**
  - `GoldBar` = 10,000,000 G = 100,000,000,000,000 C  
    大規模取引用の束。直接のドロップは稀。主にGのパッケージ化で生成。
  - `LegendaryBar` = 1,000 GoldBar  
    ギルド/国家規模の超高額決済専用単位。

- **課金/専用/限定通貨**
  - `Gem` は変動レート（法定通貨連動）。基本通貨への自動交換は不可。公式`ExchangeCurrency`のみ明示交換可。
  - `GloryToken` / `GuildCoin` / `StarDrop` は原則交換不可（交換経路はイベント/モード限定）。

### 交換ルール（Cloud Code）
- **自動交換なし**: 交換は必ず `ExchangeCurrency` を明示実行。  
- **手数料**: `feeRate` を通貨/方向ごとに設定（例: G→Sは1%、S→Gは5%）。
- **上限/閾値**: 1回あたりの交換上限、1日の上限、最小交換単位を設定。
- **優先バンドル**: 基本は上位→下位の両替を推奨（P→G→E→S→C）。
- **イベント倍率**: Remote Config の `exchangeMultipliers` により期間限定で倍率変更。

#### Remote Config（例）
```json
{
  "exchange": {
    "feeRate": { "G_to_S": 0.01, "S_to_G": 0.05 },
    "multipliers": { "eventKey": { "Halloween2025": 0.9 } }
  }
}
```

#### `ExchangeCurrency` のI/O（方針）
- req: `{ playerId, from: { currencyId, amount }, to: { currencyId }, allowAlt?: boolean }`
- res: `{ credited: number, debited: number, feeApplied: number, rateUsed: number }`

### 表示上の工夫（高額感の演出）
- 大きな単位を優先表示（例: 1,234,567C → 123G 45S 67C）。
- GoldBar/Platinum/LegendaryBarは特別な色/装飾でUI表示。
- 交換UIは「束換算」を強調（例: 1 GoldBar = 10,000,000G, 1 LegendaryBar = 1,000 GoldBar）。

## 所持金表示（上位優先＋位取り）

### ルール
- **[分解順]** `LegendaryBar` → `GoldBar` → `Platinum` → `Gold` → `Electrum` → `Silver` → `Copper`
- **[優先表示]** 上位単位から順に、0でない単位のみを表示。区切りは半角スペース。
- **[位取り]** 各単位の数値は3桁区切り（例: `1,234G`）。
- **[併記]** 合計C表記（縮約、例: `≈ 12.3T C`）を括弧で併記可。

### 擬似コード（TypeScript）
```ts
// コメント: 合計Copper額を上位優先で分解してフォーマット
type Unit = { id: string; label: string; valueInC: bigint };
const UNITS: Unit[] = [
  { id: "LegendaryBar", label: "LBar", valueInC: 100000000000000n * 1000n }, // 1,000 GoldBar
  { id: "GoldBar",      label: "GBar", valueInC: 100000000000000n },         // 10,000,000 G
  { id: "Platinum",     label: "P",    valueInC: 1000000000n },
  { id: "Gold",         label: "G",    valueInC: 10000000n },
  { id: "Electrum",     label: "E",    valueInC: 10000n },
  { id: "Silver",       label: "S",    valueInC: 1000n },
  { id: "Copper",       label: "C",    valueInC: 1n },
];

export function formatWealth(totalC: bigint): string {
  const parts: string[] = [];
  let rest = totalC;
  for (const u of UNITS) {
    const cnt = rest / u.valueInC;
    if (cnt > 0n) {
      parts.push(`${cnt.toString()}${u.label}`);
      rest = rest % u.valueInC;
    }
  }
  const formatted = parts.join(" ");
  // 併記（例示）: 12.3T C
  const approx = Number(totalC) >= 1e12 ? ` (≈ ${(Number(totalC)/1e12).toFixed(1)}T C)` : "";
  return formatted + approx;
}

---

## 手数料/上限の初期設定（おすすめ）

### 方向別手数料（feeRate）
- **上位→下位（目減り少）**
  - `P→G`: 0.5%
  - `G→E`: 0.5%
  - `E→S`: 0.5%
  - `S→C`: 0%
- **下位→上位（重課）**
  - `C→S`: 5%
  - `S→E`: 5%
  - `E→G`: 10%
  - `G→P`: 15%
- **高額束**
  - `G→GoldBar`: 2%
  - `GoldBar→LegendaryBar`: 3%
  - 逆方向はそれぞれ半分の手数料

### 最小交換単位・単回/日次上限
- **最小交換単位**
  - `S→E`: 1,000S 以上
  - `E→G`: 1,000E 以上
  - `G→P`: 10,000G 以上
  - `G→GoldBar`: 1,000,000G 以上
  - `GoldBar→LegendaryBar`: 100 GoldBar 以上
- **単回上限**
  - `下位→上位`: Copper換算で `≤ 1e12 C`
  - `上位→下位`: Copper換算で `≤ 1e13 C`
- **日次上限（プレイヤー単位）**
  - `下位→上位`: 3回/日
  - `上位→下位`: 10回/日
  - `GoldBar/LegendaryBar`を含む交換: 1回/日

### Remote Config キー例
```json
{
  "exchange": {
    "feeRate": {
      "P_to_G": 0.005, "G_to_E": 0.005, "E_to_S": 0.005, "S_to_C": 0.0,
      "C_to_S": 0.05,  "S_to_E": 0.05,  "E_to_G": 0.10,  "G_to_P": 0.15,
      "G_to_GBar": 0.02, "GBar_to_LBar": 0.03,
      "GBar_to_G": 0.01, "LBar_to_GBar": 0.015
    },
    "minUnit": {
      "S_to_E": 1000, "E_to_G": 1000, "G_to_P": 10000,
      "G_to_GBar": 1000000, "GBar_to_LBar": 100
    },
    "limits": {
      "perTxUp": 1e12, "perTxDown": 1e13,
      "dailyUpCount": 3, "dailyDownCount": 10, "dailyBundleCount": 1
    },
    "multipliers": { }
  }
}
```

---

## Vercel ホスティング設定（管理コンソール）

### 環境変数（例）
- `UNITY_ORG_ID`
- `UNITY_PROJECT_ID`
- `UNITY_ENVIRONMENT_ID`
- `UNITY_CLIENT_ID`（Service Account）
- `UNITY_CLIENT_SECRET`
- `CLOUD_CODE_BASE_URL`（例: `https://services.api.unity.com/cloud-code/v1`）
- `CLOUD_CODE_SERVICE_ID`（プロジェクトのCloud CodeサービスID）
- `ALLOWED_ADMIN_EMAILS`（管理者メールのカンマ区切り）

### API エンドポイント（Next.js）
- `POST /api/cc/exchange` → Cloud Code `ExchangeCurrency`
- `POST /api/cc/currencies/upsert` → `AdminUpsertCurrency`
- `POST /api/cc/currencies/grant` → `AdminGrantCurrency`
- `POST /api/cc/currencies/subtract` → `AdminSubtractCurrency`
- `POST /api/cc/catalog/upsert` → `AdminUpsertCatalogItem`
- `POST /api/cc/inventory/grant` → `AddItem`
- `POST /api/cc/inventory/repair` → `RepairItem`

### セキュリティ方針
- 管理UIは**サーバ側保護**（メール許可リスト＋セッション）。
- Cloud Code呼び出しは**サーバサイドのみ**で実行（クライアントから直叩き禁止）。
- 環境変数はProduction/Previewで分離。秘密情報はGitに含めない。